from bahn import BahnAPI
import datetime
import tabulate
from urllib.parse import urlencode
api = BahnAPI()
def pprint_connction(connection, traveler):
	date = datetime.datetime.strftime(connection["departure"]["time"], "%d.%m.%y")
	time = datetime.datetime.strftime(connection["departure"]["time"], "%H:%M")
	data = {"S":connection["departure"]["stop"]["name"],
	"Z":connection["arrival"]["stop"]["name"],
	"date":date,
	"time":time,
	"timesel":"depart",
	"tariffTravellerType.1":BahnAPI().traveler_types[traveler[0]],
	"tariffTravellerReductionClass.1":BahnAPI().redtnCards[traveler[1]],
	"start":"1"}
	url = "https://reiseauskunft.bahn.de/bin/query.exe/dn?" + urlencode(data)
	dauer = connection["duration"]
	umstiege = len(connection["sections"])-1
	abfahrt = connection["departure"]["time"]
	ankunft = connection["arrival"]["time"]
	return [dauer, umstiege, abfahrt, ankunft, url]
CONNECTIONS_TO_COLLECT = 6
START = "Dortmund"
END = "Leipzig"
TRAVELERS = [("adult", "25_2"), ("adult", "50_2")]
START_TIME = datetime.datetime(2016, 5, 1)
MODE = "live"
print("Downloading connections")
cons = []
for traveler in TRAVELERS:
	if MODE == "test":
		connections = [{'sections': [{'arrival': {'location': 'Hannover Hbf', 'platform': '9', 'time': datetime.datetime(2016, 4, 30, 10, 19)}, 'departure': {'location': 'Dortmund Hbf', 'platform': '10', 'time': datetime.datetime(2016, 4, 30, 5, 47)}, 'duration': datetime.timedelta(0, 16320), 'stops': []}, {'arrival': {'location': 'Leipzig Hbf', 'platform': '15', 'time': datetime.datetime(2016, 4, 30, 10, 19)}, 'departure': {'location': 'Hannover Hbf', 'platform': '10', 'time': datetime.datetime(2016, 4, 30, 5, 47)}, 'duration': datetime.timedelta(0, 16320), 'stops': []}], 'days_human': 'nicht 16. Mai, 3. Okt', 'duration': datetime.timedelta(0, 16320), 'days_binary': '01111110111100011110101111110111111011111101111110111111011111101111110111111011111101111110111111011111000111110111111011111101111110111111011111101111110011111011111101111110111111011111101111110111111011111101111110111111011111101111110111111011111101111110111111011111101111110111111011111100111110111111011111101111110111111011111101111110111111011111101111110000', 'departure': {'platform': '10', 'stop': {'lid': 'A=1@O=Dortmund Hbf@X=7459293@Y=51517898@U=80@L=008000080@B=1@p=1461715287@', 'name': 'Dortmund Hbf', 'type': 'S'}, 'time': datetime.datetime(2016, 4, 30, 5, 47)}, 'arrival': {'platform': '15', 'stop': {'lid': 'A=1@O=Leipzig Hbf@X=12383333@Y=51346546@U=80@L=008010205@B=1@p=1461715287@', 'name': 'Leipzig Hbf', 'type': 'S'}, 'time': datetime.datetime(2016, 4, 30, 10, 19)}, 'fares': [{'buttonText': 'Zur Angebotsauswahl', 'isUpsell': False, 'price': 51.75, 'prc': 5175, 'isBookable': True, 'targetCtx': 'D', 'isFromPrice': True}]}, {'sections': [{'arrival': {'location': 'Leipzig Hbf', 'platform': '13', 'time': datetime.datetime(2016, 4, 30, 11, 17)}, 'departure': {'location': 'Dortmund Hbf', 'platform': '10', 'time': datetime.datetime(2016, 4, 30, 6, 28)}, 'duration': datetime.timedelta(0, 17340), 'stops': []}], 'days_human': 'nicht 16. Mai, 3. Okt', 'duration': datetime.timedelta(0, 17340), 'days_binary': '01111110111100011110101111110111111011111001111100111111011111101111110111111011111101111110111111011111100111110111111011111101111110111111011111101111110011111011111101111110111111011111101111110111111011111101111110111111011111101111110111111011111101111110111111011111101111110111111011111100111110111111011111101111110111111011111101111110111111011111101111110000', 'departure': {'platform': '10', 'stop': {'lid': 'A=1@O=Dortmund Hbf@X=7459293@Y=51517898@U=80@L=008000080@B=1@p=1461715287@', 'name': 'Dortmund Hbf', 'type': 'S'}, 'time': datetime.datetime(2016, 4, 30, 6, 28)}, 'arrival': {'platform': '13', 'stop': {'lid': 'A=1@O=Leipzig Hbf@X=12383333@Y=51346546@U=80@L=008010205@B=1@p=1461715287@', 'name': 'Leipzig Hbf', 'type': 'S'}, 'time': datetime.datetime(2016, 4, 30, 11, 17)}, 'fares': [{'buttonText': 'Zur Angebotsauswahl', 'isUpsell': False, 'price': 44.25, 'prc': 4425, 'isBookable': True, 'targetCtx': 'D', 'isFromPrice': True}]}, {'sections': [{'arrival': {'location': 'Hannover Hbf', 'platform': '9', 'time': datetime.datetime(2016, 4, 30, 11, 17)}, 'departure': {'location': 'Dortmund Hbf', 'platform': '10', 'time': datetime.datetime(2016, 4, 30, 6, 48)}, 'duration': datetime.timedelta(0, 16140), 'stops': []}, {'arrival': {'location': 'Leipzig Hbf', 'platform': '13', 'time': datetime.datetime(2016, 4, 30, 11, 17)}, 'departure': {'location': 'Hannover Hbf', 'platform': '10', 'time': datetime.datetime(2016, 4, 30, 6, 48)}, 'duration': datetime.timedelta(0, 16140), 'stops': []}], 'days_human': 'nicht 6., 16. Mai, 3. Okt', 'duration': datetime.timedelta(0, 16140), 'days_binary': '01111110111100011110101111110111111011111001111100111111011111101111110111111011111101111110111111011111100111110111111011111101111110100011011110101111110011111011111101111110111111011111101111110111111011111101111110111111011111101111110111111011111101111110111111011111101111110111111011111100111110111111011111101111110111111011111101111110111111011111101111110000', 'departure': {'platform': '10', 'stop': {'lid': 'A=1@O=Dortmund Hbf@X=7459293@Y=51517898@U=80@L=008000080@B=1@p=1461715287@', 'name': 'Dortmund Hbf', 'type': 'S'}, 'time': datetime.datetime(2016, 4, 30, 6, 48)}, 'arrival': {'platform': '13', 'stop': {'lid': 'A=1@O=Leipzig Hbf@X=12383333@Y=51346546@U=80@L=008010205@B=1@p=1461715287@', 'name': 'Leipzig Hbf', 'type': 'S'}, 'time': datetime.datetime(2016, 4, 30, 11, 17)}, 'fares': [{'buttonText': 'Zur Angebotsauswahl', 'isUpsell': False, 'price': 57.75, 'prc': 5775, 'isBookable': True, 'targetCtx': 'D', 'isFromPrice': True}]}, {'sections': [{'arrival': {'location': 'Hannover Hbf', 'platform': '9', 'time': datetime.datetime(2016, 4, 30, 12, 19)}, 'departure': {'location': 'Dortmund Hbf', 'platform': '10', 'time': datetime.datetime(2016, 4, 30, 7, 48)}, 'duration': datetime.timedelta(0, 16260), 'stops': []}, {'arrival': {'location': 'Leipzig Hbf', 'platform': '15', 'time': datetime.datetime(2016, 4, 30, 12, 19)}, 'departure': {'location': 'Hannover Hbf', 'platform': '10', 'time': datetime.datetime(2016, 4, 30, 7, 48)}, 'duration': datetime.timedelta(0, 16260), 'stops': []}], 'days_human': 'nicht 16. Mai, 3. Okt', 'duration': datetime.timedelta(0, 16260), 'days_binary': '01111110111100011110101111110111111011111101111110111111011111101111110111111011111101111110111111011111000111110111111011111101111110111111011111101111110011111011111101111110111111011111101111110111111011111101111110111111011111101111110111111011111101111110111111011111101111110111111011111100111110111111011111101111110111111011111101111110111111011111101111110000', 'departure': {'platform': '10', 'stop': {'lid': 'A=1@O=Dortmund Hbf@X=7459293@Y=51517898@U=80@L=008000080@B=1@p=1461715287@', 'name': 'Dortmund Hbf', 'type': 'S'}, 'time': datetime.datetime(2016, 4, 30, 7, 48)}, 'arrival': {'platform': '15', 'stop': {'lid': 'A=1@O=Leipzig Hbf@X=12383333@Y=51346546@U=80@L=008010205@B=1@p=1461715287@', 'name': 'Leipzig Hbf', 'type': 'S'}, 'time': datetime.datetime(2016, 4, 30, 12, 19)}, 'fares': [{'buttonText': 'Zur Angebotsauswahl', 'isUpsell': False, 'price': 65.25, 'prc': 6525, 'isBookable': True, 'targetCtx': 'D', 'isFromPrice': True}]}, {'sections': [{'arrival': {'location': 'Leipzig Hbf', 'platform': '13', 'time': datetime.datetime(2016, 4, 30, 13, 17)}, 'departure': {'location': 'Dortmund Hbf', 'platform': '10', 'time': datetime.datetime(2016, 4, 30, 8, 28)}, 'duration': datetime.timedelta(0, 17340), 'stops': []}], 'days_human': 'nicht 16. Mai, 3. Okt', 'duration': datetime.timedelta(0, 17340), 'days_binary': '01111110111100011110101111100111111011111001111100111111011111101111110111111011111101111110111111011111100111110111111011111101111110111111011111101111110011111011111101111110111111011111101111110111111011111101111110111111011111101111110111111011111101111110111111011111101111110111111011111100111110111111011111101111110111111011111101111110111111011111101111110000', 'departure': {'platform': '10', 'stop': {'lid': 'A=1@O=Dortmund Hbf@X=7459293@Y=51517898@U=80@L=008000080@B=1@p=1461715287@', 'name': 'Dortmund Hbf', 'type': 'S'}, 'time': datetime.datetime(2016, 4, 30, 8, 28)}, 'arrival': {'platform': '13', 'stop': {'lid': 'A=1@O=Leipzig Hbf@X=12383333@Y=51346546@U=80@L=008010205@B=1@p=1461715287@', 'name': 'Leipzig Hbf', 'type': 'S'}, 'time': datetime.datetime(2016, 4, 30, 13, 17)}, 'fares': [{'buttonText': 'Zur Angebotsauswahl', 'isUpsell': False, 'price': 59.25, 'prc': 5925, 'isBookable': True, 'targetCtx': 'D', 'isFromPrice': True}]}, {'sections': [{'arrival': {'location': 'Hannover Hbf', 'platform': '9', 'time': datetime.datetime(2016, 4, 30, 13, 17)}, 'departure': {'location': 'Dortmund Hbf', 'platform': '10', 'time': datetime.datetime(2016, 4, 30, 8, 48)}, 'duration': datetime.timedelta(0, 16140), 'stops': []}, {'arrival': {'location': 'Leipzig Hbf', 'platform': '13', 'time': datetime.datetime(2016, 4, 30, 13, 17)}, 'departure': {'location': 'Hannover Hbf', 'platform': '10', 'time': datetime.datetime(2016, 4, 30, 8, 48)}, 'duration': datetime.timedelta(0, 16140), 'stops': []}], 'days_human': 'nicht 2. Okt; auch 3. Okt', 'duration': datetime.timedelta(0, 16140), 'days_binary': '10000011000111100011110000001000001100000010000001000001100000110000011000001100000110000011000000000001101000011000001100000110000011000001100000110000011000001100000110000011000001100000110000011000001100000110000011000001100000110000011000001100000110000011000001100000110000011000001100000101000011000001100000110000011000001100000110000011000001100000110000010000', 'departure': {'platform': '10', 'stop': {'lid': 'A=1@O=Dortmund Hbf@X=7459293@Y=51517898@U=80@L=008000080@B=1@p=1461715287@', 'name': 'Dortmund Hbf', 'type': 'S'}, 'time': datetime.datetime(2016, 4, 30, 8, 48)}, 'arrival': {'platform': '13', 'stop': {'lid': 'A=1@O=Leipzig Hbf@X=12383333@Y=51346546@U=80@L=008010205@B=1@p=1461715287@', 'name': 'Leipzig Hbf', 'type': 'S'}, 'time': datetime.datetime(2016, 4, 30, 13, 17)}, 'fares': [{'buttonText': 'Zur Angebotsauswahl', 'isUpsell': False, 'price': 65.25, 'prc': 6525, 'isBookable': True, 'targetCtx': 'D', 'isFromPrice': True}]}, {'sections': [{'arrival': {'location': 'Hannover Hbf', 'platform': '9', 'time': datetime.datetime(2016, 4, 30, 14, 19)}, 'departure': {'location': 'Dortmund Hbf', 'platform': '10', 'time': datetime.datetime(2016, 4, 30, 9, 48)}, 'duration': datetime.timedelta(0, 16260), 'stops': []}, {'arrival': {'location': 'Leipzig Hbf', 'platform': '15', 'time': datetime.datetime(2016, 4, 30, 14, 19)}, 'departure': {'location': 'Hannover Hbf', 'platform': '10', 'time': datetime.datetime(2016, 4, 30, 9, 48)}, 'duration': datetime.timedelta(0, 16260), 'stops': []}], 'days_human': '', 'duration': datetime.timedelta(0, 16260), 'days_binary': '00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000011111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111110000', 'departure': {'platform': '10', 'stop': {'lid': 'A=1@O=Dortmund Hbf@X=7459293@Y=51517898@U=80@L=008000080@B=1@p=1461715287@', 'name': 'Dortmund Hbf', 'type': 'S'}, 'time': datetime.datetime(2016, 4, 30, 9, 48)}, 'arrival': {'platform': '15', 'stop': {'lid': 'A=1@O=Leipzig Hbf@X=12383333@Y=51346546@U=80@L=008010205@B=1@p=1461715287@', 'name': 'Leipzig Hbf', 'type': 'S'}, 'time': datetime.datetime(2016, 4, 30, 14, 19)}, 'fares': [{'buttonText': 'Zur Angebotsauswahl', 'isUpsell': False, 'price': 65.25, 'prc': 6525, 'isBookable': True, 'targetCtx': 'D', 'isFromPrice': True}]}, {'sections': [{'arrival': {'location': 'Leipzig Hbf', 'platform': '13', 'time': datetime.datetime(2016, 4, 30, 15, 17)}, 'departure': {'location': 'Dortmund Hbf', 'platform': '10', 'time': datetime.datetime(2016, 4, 30, 10, 28)}, 'duration': datetime.timedelta(0, 17340), 'stops': []}], 'days_human': '', 'duration': datetime.timedelta(0, 17340), 'days_binary': '11111111111111111111111111111111111011111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111110000', 'departure': {'platform': '10', 'stop': {'lid': 'A=1@O=Dortmund Hbf@X=7459293@Y=51517898@U=80@L=008000080@B=1@p=1461715287@', 'name': 'Dortmund Hbf', 'type': 'S'}, 'time': datetime.datetime(2016, 4, 30, 10, 28)}, 'arrival': {'platform': '13', 'stop': {'lid': 'A=1@O=Leipzig Hbf@X=12383333@Y=51346546@U=80@L=008010205@B=1@p=1461715287@', 'name': 'Leipzig Hbf', 'type': 'S'}, 'time': datetime.datetime(2016, 4, 30, 15, 17)}, 'fares': [{'buttonText': 'Zur Angebotsauswahl', 'isUpsell': False, 'price': 59.25, 'prc': 5925, 'isBookable': True, 'targetCtx': 'D', 'isFromPrice': True}]}, {'sections': [{'arrival': {'location': 'Hannover Hbf', 'platform': '9', 'time': datetime.datetime(2016, 4, 30, 15, 17)}, 'departure': {'location': 'Dortmund Hbf', 'platform': '10', 'time': datetime.datetime(2016, 4, 30, 10, 48)}, 'duration': datetime.timedelta(0, 16140), 'stops': []}, {'arrival': {'location': 'Leipzig Hbf', 'platform': '13', 'time': datetime.datetime(2016, 4, 30, 15, 17)}, 'departure': {'location': 'Hannover Hbf', 'platform': '10', 'time': datetime.datetime(2016, 4, 30, 10, 48)}, 'duration': datetime.timedelta(0, 16140), 'stops': []}], 'days_human': 'nicht 10. Mai', 'duration': datetime.timedelta(0, 16140), 'days_binary': '11111111111111111111111111111111111011111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111100011111111111011111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111110000', 'departure': {'platform': '10', 'stop': {'lid': 'A=1@O=Dortmund Hbf@X=7459293@Y=51517898@U=80@L=008000080@B=1@p=1461715287@', 'name': 'Dortmund Hbf', 'type': 'S'}, 'time': datetime.datetime(2016, 4, 30, 10, 48)}, 'arrival': {'platform': '13', 'stop': {'lid': 'A=1@O=Leipzig Hbf@X=12383333@Y=51346546@U=80@L=008010205@B=1@p=1461715287@', 'name': 'Leipzig Hbf', 'type': 'S'}, 'time': datetime.datetime(2016, 4, 30, 15, 17)}, 'fares': [{'buttonText': 'Zur Angebotsauswahl', 'isUpsell': False, 'price': 65.25, 'prc': 6525, 'isBookable': True, 'targetCtx': 'D', 'isFromPrice': True}]}, {'sections': [{'arrival': {'location': 'Hannover Hbf', 'platform': '9', 'time': datetime.datetime(2016, 4, 30, 16, 19)}, 'departure': {'location': 'Dortmund Hbf', 'platform': '10', 'time': datetime.datetime(2016, 4, 30, 11, 48)}, 'duration': datetime.timedelta(0, 16260), 'stops': []}, {'arrival': {'location': 'Leipzig Hbf', 'platform': '15', 'time': datetime.datetime(2016, 4, 30, 16, 19)}, 'departure': {'location': 'Hannover Hbf', 'platform': '10', 'time': datetime.datetime(2016, 4, 30, 11, 48)}, 'duration': datetime.timedelta(0, 16260), 'stops': []}], 'days_human': '', 'duration': datetime.timedelta(0, 16260), 'days_binary': '11111111111101111110011111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111110000', 'departure': {'platform': '10', 'stop': {'lid': 'A=1@O=Dortmund Hbf@X=7459293@Y=51517898@U=80@L=008000080@B=1@p=1461715287@', 'name': 'Dortmund Hbf', 'type': 'S'}, 'time': datetime.datetime(2016, 4, 30, 11, 48)}, 'arrival': {'platform': '15', 'stop': {'lid': 'A=1@O=Leipzig Hbf@X=12383333@Y=51346546@U=80@L=008010205@B=1@p=1461715287@', 'name': 'Leipzig Hbf', 'type': 'S'}, 'time': datetime.datetime(2016, 4, 30, 16, 19)}, 'fares': [{'buttonText': 'Zur Angebotsauswahl', 'isUpsell': False, 'price': 65.25, 'prc': 6525, 'isBookable': True, 'targetCtx': 'D', 'isFromPrice': True}]}, {'sections': [{'arrival': {'location': 'Leipzig Hbf', 'platform': '13', 'time': datetime.datetime(2016, 4, 30, 17, 17)}, 'departure': {'location': 'Dortmund Hbf', 'platform': '10', 'time': datetime.datetime(2016, 4, 30, 12, 28)}, 'duration': datetime.timedelta(0, 17340), 'stops': []}], 'days_human': 'nicht 15. Mai; auch 4., 16. Mai, 3. Okt', 'duration': datetime.timedelta(0, 17340), 'days_binary': '10000111001101100110110000100000011000001000000100000011100001110000100000010000001110000100000000100011001000111000011100001110000111000011100101110000110100011100001110000111000011100001110000111000011100001110000111000011100001110000111000011100001110000111000011100001110000111000011100001111000111000011100001110000111000011100001110000111000011100001110000110000', 'departure': {'platform': '10', 'stop': {'lid': 'A=1@O=Dortmund Hbf@X=7459293@Y=51517898@U=80@L=008000080@B=1@p=1461715287@', 'name': 'Dortmund Hbf', 'type': 'S'}, 'time': datetime.datetime(2016, 4, 30, 12, 28)}, 'arrival': {'platform': '13', 'stop': {'lid': 'A=1@O=Leipzig Hbf@X=12383333@Y=51346546@U=80@L=008010205@B=1@p=1461715287@', 'name': 'Leipzig Hbf', 'type': 'S'}, 'time': datetime.datetime(2016, 4, 30, 17, 17)}, 'fares': [{'buttonText': 'Zur Angebotsauswahl', 'isUpsell': False, 'price': 51.75, 'prc': 5175, 'isBookable': True, 'targetCtx': 'D', 'isFromPrice': True}]}, {'sections': [{'arrival': {'location': 'Hannover Hbf', 'platform': '9', 'time': datetime.datetime(2016, 4, 30, 17, 17)}, 'departure': {'location': 'Dortmund Hbf', 'platform': '10', 'time': datetime.datetime(2016, 4, 30, 12, 48)}, 'duration': datetime.timedelta(0, 16140), 'stops': []}, {'arrival': {'location': 'Leipzig Hbf', 'platform': '13', 'time': datetime.datetime(2016, 4, 30, 17, 17)}, 'departure': {'location': 'Hannover Hbf', 'platform': '10', 'time': datetime.datetime(2016, 4, 30, 12, 48)}, 'duration': datetime.timedelta(0, 16140), 'stops': []}], 'days_human': 'nicht 15. Mai; auch 16. Mai, 3. Okt', 'duration': datetime.timedelta(0, 16140), 'days_binary': '10000011000111100011110000011000001000000110000011000001100000110000011000001100000110000011000000100001001000011000001100000110000011000001100000110000010100001100000110000011000001100000110000011000001100000110000011000001100000110000011000001100000110000011000001100000110000011000001100000111000011000001100000110000011000001100000110000011000001100000110000010000', 'departure': {'platform': '10', 'stop': {'lid': 'A=1@O=Dortmund Hbf@X=7459293@Y=51517898@U=80@L=008000080@B=1@p=1461715287@', 'name': 'Dortmund Hbf', 'type': 'S'}, 'time': datetime.datetime(2016, 4, 30, 12, 48)}, 'arrival': {'platform': '13', 'stop': {'lid': 'A=1@O=Leipzig Hbf@X=12383333@Y=51346546@U=80@L=008010205@B=1@p=1461715287@', 'name': 'Leipzig Hbf', 'type': 'S'}, 'time': datetime.datetime(2016, 4, 30, 17, 17)}, 'fares': [{'buttonText': 'Zur Angebotsauswahl', 'isUpsell': False, 'price': 65.25, 'prc': 6525, 'isBookable': True, 'targetCtx': 'D', 'isFromPrice': True}]}, {'sections': [{'arrival': {'location': 'Hannover Hbf', 'platform': '9', 'time': datetime.datetime(2016, 4, 30, 18, 19)}, 'departure': {'location': 'Dortmund Hbf', 'platform': '10', 'time': datetime.datetime(2016, 4, 30, 13, 47)}, 'duration': datetime.timedelta(0, 16320), 'stops': []}, {'arrival': {'location': 'Magdeburg Hbf', 'platform': '8', 'time': datetime.datetime(2016, 4, 30, 18, 19)}, 'departure': {'location': 'Hannover Hbf', 'platform': '10', 'time': datetime.datetime(2016, 4, 30, 13, 47)}, 'duration': datetime.timedelta(0, 16320), 'stops': []}, {'arrival': {'location': 'Leipzig Hbf', 'platform': '15', 'time': datetime.datetime(2016, 4, 30, 18, 19)}, 'departure': {'location': 'Magdeburg Hbf', 'platform': '3', 'time': datetime.datetime(2016, 4, 30, 13, 47)}, 'duration': datetime.timedelta(0, 16320), 'stops': []}], 'days_human': '', 'duration': datetime.timedelta(0, 16320), 'days_binary': '00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111110000', 'departure': {'platform': '10', 'stop': {'lid': 'A=1@O=Dortmund Hbf@X=7459293@Y=51517898@U=80@L=008000080@B=1@p=1461715287@', 'name': 'Dortmund Hbf', 'type': 'S'}, 'time': datetime.datetime(2016, 4, 30, 13, 47)}, 'arrival': {'platform': '15', 'stop': {'lid': 'A=1@O=Leipzig Hbf@X=12383333@Y=51346546@U=80@L=008010205@B=1@p=1461715287@', 'name': 'Leipzig Hbf', 'type': 'S'}, 'time': datetime.datetime(2016, 4, 30, 18, 19)}, 'fares': [{'buttonText': 'Zur Angebotsauswahl', 'isUpsell': False, 'price': 65.25, 'prc': 6525, 'isBookable': True, 'targetCtx': 'D', 'isFromPrice': True}]}, {'sections': [{'arrival': {'location': 'Berlin Hbf (tief)', 'platform': '2 D - G', 'time': datetime.datetime(2016, 4, 30, 18, 43)}, 'departure': {'location': 'Dortmund Hbf', 'platform': '10', 'time': datetime.datetime(2016, 4, 30, 13, 47)}, 'duration': datetime.timedelta(0, 17760), 'stops': []}, {'arrival': {'location': 'Leipzig Hbf', 'platform': '11', 'time': datetime.datetime(2016, 4, 30, 18, 43)}, 'departure': {'location': 'Berlin Hbf (tief)', 'platform': '2', 'time': datetime.datetime(2016, 4, 30, 13, 47)}, 'duration': datetime.timedelta(0, 17760), 'stops': []}], 'days_human': '30. Apr bis 3. Sep 2016; nicht 21., 22. Mai, 30. Mai bis 12. Jun 2016', 'duration': datetime.timedelta(0, 17760), 'days_binary': '00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001111111111111111111110000000000000000111111111111111111111111110011111110000000000000011111111111111111111111111111111111111111111111111111111111111111111111111111111111000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000', 'departure': {'platform': '10', 'stop': {'lid': 'A=1@O=Dortmund Hbf@X=7459293@Y=51517898@U=80@L=008000080@B=1@p=1461715287@', 'name': 'Dortmund Hbf', 'type': 'S'}, 'time': datetime.datetime(2016, 4, 30, 13, 47)}, 'arrival': {'platform': '11', 'stop': {'lid': 'A=1@O=Leipzig Hbf@X=12383333@Y=51346546@U=80@L=008010205@B=1@p=1461715287@', 'name': 'Leipzig Hbf', 'type': 'S'}, 'time': datetime.datetime(2016, 4, 30, 18, 43)}, 'fares': [{'buttonText': 'Zur Angebotsauswahl', 'isUpsell': False, 'price': 83.25, 'prc': 8325, 'isBookable': True, 'targetCtx': 'D', 'isFromPrice': True}]}, {'sections': [{'arrival': {'location': 'Berlin Hbf (tief)', 'platform': '2 D - G', 'time': datetime.datetime(2016, 4, 30, 19, 43)}, 'departure': {'location': 'Dortmund Hbf', 'platform': '10', 'time': datetime.datetime(2016, 4, 30, 14, 48)}, 'duration': datetime.timedelta(0, 17700), 'stops': []}, {'arrival': {'location': 'Leipzig Hbf', 'platform': '13', 'time': datetime.datetime(2016, 4, 30, 19, 43)}, 'departure': {'location': 'Berlin Hbf (tief)', 'platform': '2', 'time': datetime.datetime(2016, 4, 30, 14, 48)}, 'duration': datetime.timedelta(0, 17700), 'stops': []}], 'days_human': '30. Apr bis 3. Sep 2016; nicht 21., 22. Mai', 'duration': datetime.timedelta(0, 17700), 'days_binary': '00000000000000000000000000000111111111111111111111111111111111111111111111111111111111111111111111111111111111111111110000000000000000111111111111111111111111110011111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000', 'departure': {'platform': '10', 'stop': {'lid': 'A=1@O=Dortmund Hbf@X=7459293@Y=51517898@U=80@L=008000080@B=1@p=1461715287@', 'name': 'Dortmund Hbf', 'type': 'S'}, 'time': datetime.datetime(2016, 4, 30, 14, 48)}, 'arrival': {'platform': '13', 'stop': {'lid': 'A=1@O=Leipzig Hbf@X=12383333@Y=51346546@U=80@L=008010205@B=1@p=1461715287@', 'name': 'Leipzig Hbf', 'type': 'S'}, 'time': datetime.datetime(2016, 4, 30, 19, 43)}, 'fares': [{'buttonText': 'Zur Angebotsauswahl', 'isUpsell': False, 'price': 83.25, 'prc': 8325, 'isBookable': True, 'targetCtx': 'D', 'isFromPrice': True}]}, {'sections': [{'arrival': {'location': 'Hannover Hbf', 'platform': '9', 'time': datetime.datetime(2016, 4, 30, 20, 19)}, 'departure': {'location': 'Dortmund Hbf', 'platform': '10', 'time': datetime.datetime(2016, 4, 30, 15, 48)}, 'duration': datetime.timedelta(0, 16260), 'stops': []}, {'arrival': {'location': 'Leipzig Hbf', 'platform': '16', 'time': datetime.datetime(2016, 4, 30, 20, 19)}, 'departure': {'location': 'Hannover Hbf', 'platform': '10', 'time': datetime.datetime(2016, 4, 30, 15, 48)}, 'duration': datetime.timedelta(0, 16260), 'stops': []}], 'days_human': '', 'duration': datetime.timedelta(0, 16260), 'days_binary': '11111111111011111101111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111110000', 'departure': {'platform': '10', 'stop': {'lid': 'A=1@O=Dortmund Hbf@X=7459293@Y=51517898@U=80@L=008000080@B=1@p=1461715287@', 'name': 'Dortmund Hbf', 'type': 'S'}, 'time': datetime.datetime(2016, 4, 30, 15, 48)}, 'arrival': {'platform': '16', 'stop': {'lid': 'A=1@O=Leipzig Hbf@X=12383333@Y=51346546@U=80@L=008010205@B=1@p=1461715287@', 'name': 'Leipzig Hbf', 'type': 'S'}, 'time': datetime.datetime(2016, 4, 30, 20, 19)}, 'fares': [{'buttonText': 'Zur Angebotsauswahl', 'isUpsell': False, 'price': 65.25, 'prc': 6525, 'isBookable': True, 'targetCtx': 'D', 'isFromPrice': True}]}, {'sections': [{'arrival': {'location': 'Hannover Hbf', 'platform': '9', 'time': datetime.datetime(2016, 4, 30, 22, 19)}, 'departure': {'location': 'Dortmund Hbf', 'platform': '10', 'time': datetime.datetime(2016, 4, 30, 17, 48)}, 'duration': datetime.timedelta(0, 16260), 'stops': []}, {'arrival': {'location': 'Leipzig Hbf', 'platform': '15', 'time': datetime.datetime(2016, 4, 30, 22, 19)}, 'departure': {'location': 'Hannover Hbf', 'platform': '10', 'time': datetime.datetime(2016, 4, 30, 17, 48)}, 'duration': datetime.timedelta(0, 16260), 'stops': []}], 'days_human': '', 'duration': datetime.timedelta(0, 16260), 'days_binary': '11111111111011111111111111111000000000000111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111110111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111110000', 'departure': {'platform': '10', 'stop': {'lid': 'A=1@O=Dortmund Hbf@X=7459293@Y=51517898@U=80@L=008000080@B=1@p=1461715287@', 'name': 'Dortmund Hbf', 'type': 'S'}, 'time': datetime.datetime(2016, 4, 30, 17, 48)}, 'arrival': {'platform': '15', 'stop': {'lid': 'A=1@O=Leipzig Hbf@X=12383333@Y=51346546@U=80@L=008010205@B=1@p=1461715287@', 'name': 'Leipzig Hbf', 'type': 'S'}, 'time': datetime.datetime(2016, 4, 30, 22, 19)}, 'fares': [{'buttonText': 'Zur Angebotsauswahl', 'isUpsell': False, 'price': 65.25, 'prc': 6525, 'isBookable': True, 'targetCtx': 'D', 'isFromPrice': True}]}, {'sections': [{'arrival': {'location': 'Hamm(Westf)', 'platform': '9', 'time': datetime.datetime(2016, 5, 1, 0, 43)}, 'departure': {'location': 'Dortmund Hbf', 'platform': '11', 'time': datetime.datetime(2016, 4, 30, 18, 28)}, 'duration': datetime.timedelta(0, 22500), 'stops': []}, {'arrival': {'location': 'Kassel-Wilhelmshöhe', 'platform': '3', 'time': datetime.datetime(2016, 5, 1, 0, 43)}, 'departure': {'location': 'Hamm(Westf)', 'platform': '4 A', 'time': datetime.datetime(2016, 4, 30, 18, 28)}, 'duration': datetime.timedelta(0, 22500), 'stops': []}, {'arrival': {'location': 'Erfurt Hbf', 'platform': '8', 'time': datetime.datetime(2016, 5, 1, 0, 43)}, 'departure': {'location': 'Kassel-Wilhelmshöhe', 'platform': '1', 'time': datetime.datetime(2016, 4, 30, 18, 28)}, 'duration': datetime.timedelta(0, 22500), 'stops': []}, {'arrival': {'location': 'Leipzig Hbf', 'platform': '12', 'time': datetime.datetime(2016, 5, 1, 0, 43)}, 'departure': {'location': 'Erfurt Hbf', 'platform': '10', 'time': datetime.datetime(2016, 4, 30, 18, 28)}, 'duration': datetime.timedelta(0, 22500), 'stops': []}], 'days_human': 'Gültigkeitstage für eine Darstellung zu komplex', 'duration': datetime.timedelta(0, 22500), 'days_binary': '00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001100010100000011100001100010110000011000001100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000', 'departure': {'platform': '11', 'stop': {'lid': 'A=1@O=Dortmund Hbf@X=7459293@Y=51517898@U=80@L=008000080@B=1@p=1461715287@', 'name': 'Dortmund Hbf', 'type': 'S'}, 'time': datetime.datetime(2016, 4, 30, 18, 28)}, 'arrival': {'platform': '12', 'stop': {'lid': 'A=1@O=Leipzig Hbf@X=12383333@Y=51346546@U=80@L=008010205@B=1@p=1461715287@', 'name': 'Leipzig Hbf', 'type': 'S'}, 'time': datetime.datetime(2016, 5, 1, 0, 43)}, 'fares': [{'buttonText': 'Zur Angebotsauswahl', 'isUpsell': False, 'price': 21.75, 'prc': 2175, 'isBookable': True, 'targetCtx': 'D', 'isFromPrice': True}]}]
	elif MODE == "live":
		res = api.searchTrip(START, END, travelers=[traveler], start_datetime=START_TIME)
		connections = res["results"]
		while connections[-1]["arrival"]["time"] - START_TIME < datetime.timedelta(hours = 2):
			res = api.searchTrip(START, END, travelers=TRAVELERS, ctx=res["ctx_later"])
			connections+=res["results"]
		with open("connections_test.json","w") as connectionsfile:
			connectionsfile.write(str(connections))
	else:
		raise Exception("Mode invalid")
	for i,connection in enumerate(connections):
		preis = sorted(["ab "+str(x["price"]) if x["isFromPrice"] else str(x["price"]) for x in connection["fares"] ])[0]
		cons.append((preis, traveler, connection))
cons.sort(key=lambda x: x[0])
final_cons = [[x[0], x[1][1], *pprint_connction(x[2], x[1])] for x in cons]
headers = ["Preis", "Bahncard", "Dauer", "Umstiege", "Abfahrtszeit", "Ankunftszeit", "URL"]
print(tabulate.tabulate(final_cons, headers, tablefmt="psql"))